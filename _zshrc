# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# Load environment variables from ~/.env if it exists
if [[ -f "$HOME/.env" && -r "$HOME/.env" ]]; then
    # Only load files owned by current user with secure permissions
    if [[ "$(stat -f %Su "$HOME/.env")" == "$(whoami)" ]] && [[ "$(stat -f %Mp%Lp "$HOME/.env")" -le 600 ]]; then
        set -a  # automatically export all variables
        source "$HOME/.env"
        set +a  # disable auto-export
    else
        echo "Warning: ~/.env has insecure permissions or ownership" >&2
    fi
fi

# Homebrew setup (macOS only, works for both Intel and Apple Silicon)
if [[ "$OSTYPE" == "darwin"* ]]; then
    if [[ -f /opt/homebrew/bin/brew ]]; then
        eval "$(/opt/homebrew/bin/brew shellenv)"  # Apple Silicon
    elif [[ -f /usr/local/bin/brew ]]; then
        eval "$(/usr/local/bin/brew shellenv)"      # Intel Mac
    fi
fi

source ~/.zplug/init.zsh
export TERM="xterm-256color"
ZSH_THEME="powerlevel10k/powerlevel10k"

zplug "zsh-users/zsh-autosuggestions"
zplug "supercrabtree/k"
zplug "plugins/git", from:oh-my-zsh
zplug romkatv/powerlevel10k, as:theme, depth:1

# Install plugins if there are plugins that have not been installed
if ! zplug check --verbose; then
    printf "Install? [y/N]: "
    if read -q; then
        echo; zplug install
    fi
fi

zplug load

alias gw="./gradlew"

DEFAULT_USER="$(whoami)"
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE="fg=#ddd"

eval "$(mise activate zsh)"

export ANDROID_HOME="$HOME/Library/Android/sdk/"
export NDK="/opt/homebrew/share/android-ndk"
export PATH=$PATH:$ANDROID_HOME/tools
export PATH=$PATH:$ANDROID_HOME/tools/bin
export PATH=$PATH:$ANDROID_HOME/platform-tools
export PATH=$PATH:$ANDROID_HOME/emulator

export PATH="$HOME/.local/bin:$PATH"
export PATH="/opt/homebrew/opt/sqlite/bin:$PATH"
. "$HOME/.local/bin/env"

export PATH="$HOME/.opencode/bin:$PATH"

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh
export LC_ALL=en_US.UTF-8
